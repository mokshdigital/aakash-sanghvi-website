<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Maner Law ‚Äì Form Submissions Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f6fa;
      color: #222;
    }

    .page {
      max-width: 1400px;
      margin: 32px auto;
      padding: 24px;
    }

    .header {
      background: #ffffff;
      padding: 24px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
      margin-bottom: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 4px solid #17358f;
    }

    .header h1 {
      margin: 0;
      font-size: 28px;
      color: #17358f;
      letter-spacing: 0.08em;
    }

    .header .stats {
      display: flex;
      gap: 24px;
    }

    .stat-box {
      text-align: center;
      padding: 12px 20px;
      background: #f8f9fa;
      border-radius: 6px;
    }

    .stat-box .number {
      font-size: 32px;
      font-weight: 700;
      color: #17358f;
    }

    .stat-box .label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .login-box {
      background: white;
      padding: 40px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      margin: 100px auto;
      text-align: center;
    }

    .login-box h2 {
      margin: 0 0 24px;
      color: #17358f;
    }

    .login-box input {
      width: 100%;
      padding: 12px;
      border: 2px solid #ccd1e0;
      border-radius: 6px;
      font-size: 16px;
      margin-bottom: 16px;
    }

    .login-box button {
      width: 100%;
      padding: 12px;
      background: #17358f;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }

    .login-box button:hover {
      background: #0f2563;
    }

    .error {
      color: #d11f2a;
      font-size: 14px;
      margin-top: 8px;
    }

    .filters {
      background: white;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
      margin-bottom: 24px;
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .filters input,
    .filters select {
      padding: 8px 12px;
      border: 1px solid #ccd1e0;
      border-radius: 4px;
      font-size: 14px;
    }

    .filters button {
      padding: 8px 16px;
      background: #17358f;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .filters button:hover {
      background: #0f2563;
    }

    .submissions-grid {
      display: grid;
      gap: 16px;
    }

    .submission-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .submission-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .submission-header {
      background: linear-gradient(135deg, #17358f, #1e40af);
      color: white;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .submission-header h3 {
      margin: 0;
      font-size: 18px;
    }

    .submission-header .date {
      font-size: 13px;
      opacity: 0.9;
    }

    .submission-body {
      padding: 24px;
    }

    .field-group {
      margin-bottom: 20px;
    }

    .field-group h4 {
      margin: 0 0 12px;
      color: #17358f;
      font-size: 16px;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 8px;
    }

    .field-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 12px;
    }

    .field {
      padding: 12px;
      background: #f8f9fa;
      border-radius: 4px;
      border-left: 3px solid #17358f;
    }

    .field-label {
      font-size: 11px;
      text-transform: uppercase;
      color: #666;
      letter-spacing: 0.05em;
      margin-bottom: 4px;
    }

    .field-value {
      font-size: 14px;
      color: #222;
      word-wrap: break-word;
    }

    .field-value.empty {
      color: #999;
      font-style: italic;
    }

    .loading {
      text-align: center;
      padding: 60px;
      color: #666;
    }

    .no-data {
      text-align: center;
      padding: 60px;
      background: white;
      border-radius: 8px;
      color: #666;
    }

    .logout-btn {
      padding: 8px 16px;
      background: #d11f2a;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .logout-btn:hover {
      background: #a01620;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      background: #e3f2fd;
      color: #1976d2;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
    }

    .badge.unread {
      background: #ffebee;
      color: #c62828;
    }
  </style>
</head>

<body>
  <div id="app"></div>

  <!-- Load Supabase from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // Supabase Configuration (embedded to avoid 404 errors)
    const SUPABASE_URL = 'https://knwwqshrneeyaxjnmyvi.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtud3dxc2hybm5lZXlheGpubXl2aSIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzY1NDY2MzY2LCJleHAiOjIwODEwNDIzNjZ9.CyJEYaLIdaexm1kk-YHrrCBXw1Ur3r97bhthc8JvpPg';

    // Initialize Supabase client
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log('‚úÖ Supabase client initialized');

    const ADMIN_PASSWORD = 'maner2024'; // Change this to your desired password

    let isAuthenticated = false;
    let submissions = [];
    let filteredSubmissions = [];
    let isLoading = false;
    let hasLoadedOnce = false;

    // Initialize on page load
    init();

    function init() {
      checkAuth();
      if (isAuthenticated && !hasLoadedOnce) {
        loadSubmissions();
      } else {
        render();
      }
    }

    function checkAuth() {
      isAuthenticated = sessionStorage.getItem('maner_admin_auth') === 'true';
    }

    function login(password) {
      if (password === ADMIN_PASSWORD) {
        isAuthenticated = true;
        sessionStorage.setItem('maner_admin_auth', 'true');
        loadSubmissions();
      } else {
        return 'Incorrect password';
      }
    }

    function logout() {
      isAuthenticated = false;
      sessionStorage.removeItem('maner_admin_auth');
      submissions = [];
      filteredSubmissions = [];
      hasLoadedOnce = false;
      render();
    }

    async function loadSubmissions() {
      if (isLoading) return; // Prevent multiple simultaneous loads

      isLoading = true;
      render(); // Show loading state

      try {
        const { data, error } = await supabase
          .from('maner_law_submissions')
          .select('*')
          .order('submitted_at', { ascending: false });

        if (error) throw error;

        submissions = data || [];
        filteredSubmissions = submissions;
        hasLoadedOnce = true;
      } catch (err) {
        console.error('Error loading submissions:', err);
        alert('Error loading submissions: ' + err.message);
      } finally {
        isLoading = false;
        render();
      }
    }

    function filterSubmissions(searchTerm) {
      if (!searchTerm) {
        filteredSubmissions = submissions;
      } else {
        const term = searchTerm.toLowerCase();
        filteredSubmissions = submissions.filter(sub =>
          sub.contact_name?.toLowerCase().includes(term) ||
          sub.contact_email?.toLowerCase().includes(term) ||
          sub.firm_name?.toLowerCase().includes(term)
        );
      }
      render();
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric',
        hour: 'numeric',
        minute: '2-digit'
      });
    }

    function render() {
      const app = document.getElementById('app');

      if (!isAuthenticated) {
        app.innerHTML = renderLogin();
        attachLoginHandlers();
        return;
      }

      if (isLoading || (!hasLoadedOnce && submissions.length === 0)) {
        app.innerHTML = renderLoading();
        return;
      }

      app.innerHTML = renderDashboard();
      attachDashboardHandlers();
    }

    function renderLogin() {
      return `
        <div class="login-box">
          <h2>üîí Admin Login</h2>
          <p style="color: #666; margin-bottom: 24px;">Enter password to view form submissions</p>
          <form id="loginForm">
            <input type="password" id="passwordInput" placeholder="Enter password" required autofocus />
            <button type="submit">Login</button>
            <div id="loginError" class="error"></div>
          </form>
        </div>
      `;
    }

    function renderLoading() {
      return `
        <div class="loading">
          <h2>Loading submissions...</h2>
        </div>
      `;
    }

    function renderDashboard() {
      const totalSubmissions = submissions.length;
      const unreadSubmissions = submissions.filter(s => !s.read).length;

      return `
        <div class="page">
          <div class="header">
            <div>
              <h1>MANER LAW</h1>
              <span style="font-size: 14px; color: #666;">Form Submissions Dashboard</span>
            </div>
            <div class="stats">
              <div class="stat-box">
                <div class="number">${totalSubmissions}</div>
                <div class="label">Total</div>
              </div>
              <div class="stat-box">
                <div class="number">${unreadSubmissions}</div>
                <div class="label">Unread</div>
              </div>
              <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
          </div>

          <div class="filters">
            <input 
              type="search" 
              id="searchInput" 
              placeholder="Search by name, email, or firm..." 
              style="flex: 1;"
            />
            <button onclick="loadSubmissions()">üîÑ Refresh</button>
          </div>

          <div class="submissions-grid">
            ${filteredSubmissions.length === 0 ? renderNoData() : filteredSubmissions.map(renderSubmission).join('')}
          </div>
        </div>
      `;
    }

    function renderNoData() {
      return `
        <div class="no-data">
          <h3>No submissions found</h3>
          <p>No form submissions match your search criteria.</p>
        </div>
      `;
    }

    function renderSubmission(sub) {
      const isEmpty = (val) => !val || val.trim() === '';
      const formatValue = (val) => isEmpty(val) ? '<span class="empty">Not provided</span>' : val;

      return `
        <div class="submission-card">
          <div class="submission-header">
            <h3>${sub.contact_name || 'Unknown'}${!sub.read ? '<span class="badge unread">NEW</span>' : ''}</h3>
            <div class="date">${formatDate(sub.submitted_at)}</div>
          </div>
          <div class="submission-body">
            <!-- Firm & Contact -->
            <div class="field-group">
              <h4>üìã Firm & Contact Information</h4>
              <div class="field-row">
                <div class="field">
                  <div class="field-label">Firm Name</div>
                  <div class="field-value">${formatValue(sub.firm_name)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Location</div>
                  <div class="field-value">${formatValue(sub.location)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Website</div>
                  <div class="field-value">${formatValue(sub.website)}</div>
                </div>
              </div>
              <div class="field-row">
                <div class="field">
                  <div class="field-label">Contact Email</div>
                  <div class="field-value">${formatValue(sub.contact_email)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Contact Phone</div>
                  <div class="field-value">${formatValue(sub.contact_phone)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Contact Role</div>
                  <div class="field-value">${formatValue(sub.contact_role)}</div>
                </div>
              </div>
            </div>

            <!-- Lawyers -->
            ${!isEmpty(sub.lawyer1_name) || !isEmpty(sub.lawyer2_name) ? `
            <div class="field-group">
              <h4>üë®‚Äç‚öñÔ∏è Lawyer Profiles</h4>
              ${!isEmpty(sub.lawyer1_name) ? `
              <div class="field-row">
                <div class="field">
                  <div class="field-label">Lawyer 1 - Name</div>
                  <div class="field-value">${formatValue(sub.lawyer1_name)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Lawyer 1 - Titles</div>
                  <div class="field-value">${formatValue(sub.lawyer1_titles)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Lawyer 1 - Email</div>
                  <div class="field-value">${formatValue(sub.lawyer1_email)}</div>
                </div>
              </div>
              ${!isEmpty(sub.lawyer1_bio) ? `
              <div class="field">
                <div class="field-label">Lawyer 1 - Bio</div>
                <div class="field-value">${formatValue(sub.lawyer1_bio)}</div>
              </div>
              ` : ''}
              ` : ''}
              ${!isEmpty(sub.lawyer2_name) ? `
              <div class="field-row">
                <div class="field">
                  <div class="field-label">Lawyer 2 - Name</div>
                  <div class="field-value">${formatValue(sub.lawyer2_name)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Lawyer 2 - Titles</div>
                  <div class="field-value">${formatValue(sub.lawyer2_titles)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Lawyer 2 - Email</div>
                  <div class="field-value">${formatValue(sub.lawyer2_email)}</div>
                </div>
              </div>
              ${!isEmpty(sub.lawyer2_bio) ? `
              <div class="field">
                <div class="field-label">Lawyer 2 - Bio</div>
                <div class="field-value">${formatValue(sub.lawyer2_bio)}</div>
              </div>
              ` : ''}
              ` : ''}
            </div>
            ` : ''}

            <!-- Practice Areas & Goals -->
            <div class="field-group">
              <h4>‚öñÔ∏è Practice Areas & Goals</h4>
              <div class="field-row">
                <div class="field">
                  <div class="field-label">Practice Areas</div>
                  <div class="field-value">${formatValue(sub.practice_areas)}</div>
                </div>
                ${!isEmpty(sub.practice_areas_other) ? `
                <div class="field">
                  <div class="field-label">Other Practice Areas</div>
                  <div class="field-value">${formatValue(sub.practice_areas_other)}</div>
                </div>
                ` : ''}
              </div>
              <div class="field-row">
                <div class="field">
                  <div class="field-label">Website Goals</div>
                  <div class="field-value">${formatValue(sub.goals)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Desired Style</div>
                  <div class="field-value">${formatValue(sub.style)}</div>
                </div>
              </div>
            </div>

            <!-- Features & Compliance -->
            <div class="field-group">
              <h4>üõ†Ô∏è Features & Compliance</h4>
              <div class="field-row">
                <div class="field">
                  <div class="field-label">Requested Features</div>
                  <div class="field-value">${formatValue(sub.features)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Compliance Requirements</div>
                  <div class="field-value">${formatValue(sub.compliance)}</div>
                </div>
              </div>
            </div>

            <!-- Timeline & Budget -->
            <div class="field-group">
              <h4>üìÖ Timeline & Budget</h4>
              <div class="field-row">
                <div class="field">
                  <div class="field-label">Timeline</div>
                  <div class="field-value">${formatValue(sub.timeline)}</div>
                </div>
                <div class="field">
                  <div class="field-label">Budget</div>
                  <div class="field-value">${formatValue(sub.budget)}</div>
                </div>
              </div>
              ${!isEmpty(sub.notes) ? `
              <div class="field">
                <div class="field-label">Additional Notes</div>
                <div class="field-value">${formatValue(sub.notes)}</div>
              </div>
              ` : ''}
            </div>
          </div>
        </div>
      `;
    }

    function attachLoginHandlers() {
      const form = document.getElementById('loginForm');
      const errorDiv = document.getElementById('loginError');

      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const password = document.getElementById('passwordInput').value;
        const error = login(password);
        if (error) {
          errorDiv.textContent = error;
        }
      });
    }

    function attachDashboardHandlers() {
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', (e) => {
        filterSubmissions(e.target.value);
      });
    }
  </script>
</body>

</html>